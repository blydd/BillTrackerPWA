# 统计页面日期范围选择功能完善

## 优化内容

在原有月份选择功能基础上，新增了自定义日期范围选择功能，让用户可以更灵活地查看任意时间段的统计数据。

## 新增功能

### 1. 自定义日期范围选择
- 在时间范围选择器中添加了"自定义范围"选项
- 用户可以自由选择开始日期和结束日期
- 支持跨月、跨年的日期范围统计

### 2. 智能日期范围显示
- 同一天：显示为"yyyy年MM月dd日"
- 同一月不同天：显示为"yyyy年MM月dd日-dd日"
- 同一年不同月：显示为"yyyy年MM月dd日-MM月dd日"
- 不同年：显示为"yyyy年MM月dd日-yyyy年MM月dd日"

### 3. 用户体验优化
- 日期范围选择器使用表单样式，更直观
- 实时显示选择的日期范围预览
- 自动校正：确保开始日期不晚于结束日期
- 结束日期自动包含整天（23:59:59）

## 功能特点

### 时间选择选项
1. **本月** - 当前月份的统计
2. **上月** - 上个月的统计
3. **选择月份** - 选择任意月份的统计
4. **自定义范围** - 选择任意日期范围的统计
5. **今年** - 当前年份的统计
6. **全部** - 所有数据的统计

### 界面设计
- **月份选择器**：使用滚轮样式，适合快速选择月份
- **日期范围选择器**：使用表单样式，支持精确的日期选择
- **智能布局**：根据选择的时间类型显示相应的选择界面

## 技术实现

### 主要变更

1. **枚举扩展**
   ```swift
   enum TimeRange: String, CaseIterable {
       case thisMonth = "本月"
       case lastMonth = "上月"
       case customMonth = "选择月份"
       case customRange = "自定义范围"  // 新增
       case thisYear = "今年"
       case all = "全部"
   }
   ```

2. **状态变量**
   ```swift
   @State private var showingDateRangePicker = false  // 统一的选择器显示状态
   @State private var customStartDate = Date()        // 自定义开始日期
   @State private var customEndDate = Date()          // 自定义结束日期
   ```

3. **日期范围计算**
   ```swift
   case .customRange:
       let endOfDay = calendar.date(bySettingHour: 23, minute: 59, second: 59, of: customEndDate) ?? customEndDate
       return (customStartDate, endOfDay)
   ```

4. **智能日期格式化**
   - 根据日期范围的跨度自动选择最合适的显示格式
   - 中文本地化显示

## 使用方法

### 选择月份
1. 在时间范围选择器中选择"选择月份"
2. 点击"选择的月份"按钮
3. 在滚轮选择器中选择目标月份
4. 点击"确定"查看该月份的统计数据

### 自定义日期范围
1. 在时间范围选择器中选择"自定义范围"
2. 点击"日期范围"按钮
3. 分别设置开始日期和结束日期
4. 查看日期范围预览
5. 点击"确定"查看该时间段的统计数据

## 优化亮点

- **灵活性**：支持任意时间段的统计查询
- **智能化**：自动校正日期范围，防止逻辑错误
- **直观性**：实时预览选择的日期范围
- **兼容性**：支持iOS 15+的弹窗样式
- **本地化**：完全中文化的日期显示

## 优化时间
2024年12月22日