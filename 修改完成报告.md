# âœ… IAP åŠŸèƒ½é›†æˆ - æ–‡ä»¶ä¿®æ”¹å®ŒæˆæŠ¥å‘Š

## ä¿®æ”¹å®Œæˆæ—¶é—´
2024-12-09

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

### âœ… 1. Views/BillFormView.swift
**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… æ·»åŠ  `@StateObject private var subscriptionManager`
- âœ… æ·»åŠ  `@State private var showingUpgradePrompt`
- âœ… åœ¨ `saveBill()` æ–¹æ³•ä¸­æ·»åŠ è´¦å•é™åˆ¶æ£€æŸ¥
- âœ… æ·»åŠ  `.upgradePrompt()` ä¿®é¥°ç¬¦

**åŠŸèƒ½**ï¼šåˆ›å»ºè´¦å•æ—¶æ£€æŸ¥æ˜¯å¦è¾¾åˆ° 500 æ¡é™åˆ¶

---

### âœ… 2. Views/BillListView.swift
**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… æ·»åŠ  `@StateObject private var subscriptionManager`
- âœ… æ·»åŠ  `@State private var showingUpgradePrompt`
- âœ… æ·»åŠ  `@State private var upgradePromptFeature`
- âœ… åœ¨ VStack é¡¶éƒ¨æ·»åŠ è´¦å•é™åˆ¶è­¦å‘Šæ¡
- âœ… ä¿®æ”¹ `exportBills()` æ–¹æ³•æ·»åŠ æƒé™æ£€æŸ¥
- âœ… æ·»åŠ  `upgradePromptTitle` å’Œ `upgradePromptMessage` å±æ€§
- âœ… æ·»åŠ  `.upgradePrompt()` ä¿®é¥°ç¬¦

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤ºè´¦å•æ•°é‡è­¦å‘Šï¼ˆ450 æ¡æ—¶ï¼‰
- å¯¼å‡ºæ•°æ®æ—¶æ£€æŸ¥ Pro æƒé™

---

### âœ… 3. ExpenseTracker/ExpenseTrackerApp.swift
**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… åœ¨ `ContentView` æ·»åŠ  `@StateObject private var subscriptionManager`
- âœ… æ·»åŠ  `.environmentObject(subscriptionManager)`
- âœ… æ·»åŠ  `.task { await subscriptionManager.refreshSubscriptionStatus() }`
- âœ… åœ¨ `SettingsView` æ·»åŠ  `@StateObject private var subscriptionManager`
- âœ… åœ¨ `SettingsView` æ·»åŠ  `@State private var showingPurchase`
- âœ… æ·»åŠ è®¢é˜…çŠ¶æ€ Sectionï¼ˆæ˜¾ç¤ºå½“å‰è®¢é˜…çŠ¶æ€å’Œå‡çº§æŒ‰é’®ï¼‰
- âœ… æ·»åŠ  `.sheet(isPresented: $showingPurchase)`
- âœ… åœ¨æ•°æ®ç®¡ç† Section æ·»åŠ "æ•°æ®åº“å¯¼å‡º"å…¥å£

**åŠŸèƒ½**ï¼š
- åº”ç”¨å¯åŠ¨æ—¶åˆ·æ–°è®¢é˜…çŠ¶æ€
- è®¾ç½®é¡µé¢æ˜¾ç¤ºè®¢é˜…çŠ¶æ€
- æä¾›å‡çº§å…¥å£
- æä¾›æ•°æ®åº“å¯¼å‡ºå…¥å£

---

### âœ… 4. Views/CloudSyncSettingsView.swift
**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… æ·»åŠ  `@StateObject private var subscriptionManager`
- âœ… æ·»åŠ  `@State private var showingPurchase`
- âœ… åœ¨ List å¼€å§‹å¤„æ·»åŠ  Pro åŠŸèƒ½æ£€æŸ¥
- âœ… æ·»åŠ å‡çº§æç¤ºç•Œé¢ï¼ˆå¸¦çš‡å† å›¾æ ‡ï¼‰
- âœ… æ·»åŠ  `.sheet(isPresented: $showingPurchase)`
- âœ… ç”¨ if-else åŒ…è£¹åŸæœ‰å†…å®¹

**åŠŸèƒ½**ï¼šå…è´¹ç‰ˆç”¨æˆ·çœ‹åˆ°å‡çº§æç¤ºï¼ŒPro ç”¨æˆ·çœ‹åˆ°äº‘åŒæ­¥è®¾ç½®

---

### âœ… 5. Models/AppError.swift
**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… æ·»åŠ  `case billLimitReached`
- âœ… æ·»åŠ  `case featureNotAvailable`
- âœ… åœ¨ `errorDescription` ä¸­æ·»åŠ å¯¹åº”çš„é”™è¯¯æè¿°

**åŠŸèƒ½**ï¼šæ”¯æŒæ–°çš„é”™è¯¯ç±»å‹

---

### âœ… 6. ViewModels/ExportViewModel.swift
**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… åœ¨ `exportToCSV` æ–¹æ³•å¼€å§‹å¤„æ·»åŠ æƒé™æ£€æŸ¥
- âœ… ä½¿ç”¨ `SubscriptionManager.shared.canExportData` æ£€æŸ¥æƒé™
- âœ… æƒé™ä¸è¶³æ—¶æŠ›å‡º `AppError.featureNotAvailable`

**åŠŸèƒ½**ï¼šå¯¼å‡º CSV å‰æ£€æŸ¥ Pro æƒé™

---

### âœ… 7. ExpenseTracker/ExpenseTrackerApp.swiftï¼ˆæ•°æ®åº“å¯¼å‡ºå…¥å£ï¼‰
**ä¿®æ”¹å†…å®¹**ï¼š
- âœ… åœ¨"æ•°æ®ç®¡ç†" Section æ·»åŠ "æ•°æ®åº“å¯¼å‡º" NavigationLink

**åŠŸèƒ½**ï¼šæä¾›æ•°æ®åº“å¯¼å‡ºåŠŸèƒ½å…¥å£

---

## ä¿®æ”¹ç»Ÿè®¡

- **ä¿®æ”¹æ–‡ä»¶æ•°é‡**: 7 ä¸ª
- **æ–°å¢ä»£ç è¡Œæ•°**: çº¦ 150 è¡Œ
- **ä¿®æ”¹ç±»å‹**: 
  - æ·»åŠ å±æ€§: 12 å¤„
  - æ·»åŠ æ–¹æ³•: 2 å¤„
  - ä¿®æ”¹æ–¹æ³•: 2 å¤„
  - æ·»åŠ  UI ç»„ä»¶: 3 å¤„
  - æ·»åŠ é”™è¯¯ç±»å‹: 2 å¤„

---

## åŠŸèƒ½éªŒè¯æ¸…å•

### å…è´¹ç‰ˆåŠŸèƒ½
- [ ] åˆ›å»ºè´¦å•åˆ° 450 æ¡æ—¶æ˜¾ç¤ºè­¦å‘Š
- [ ] åˆ›å»ºè´¦å•åˆ° 500 æ¡æ—¶è¢«é˜»æ­¢
- [ ] ç‚¹å‡»å¯¼å‡ºæŒ‰é’®æç¤ºå‡çº§
- [ ] ç‚¹å‡»äº‘åŒæ­¥æç¤ºå‡çº§
- [ ] è®¾ç½®é¡µé¢æ˜¾ç¤º"å…è´¹ç‰ˆ"çŠ¶æ€

### Pro ç‰ˆåŠŸèƒ½ï¼ˆéœ€è¦è´­ä¹°åæµ‹è¯•ï¼‰
- [ ] å¯ä»¥åˆ›å»ºè¶…è¿‡ 500 æ¡è´¦å•
- [ ] å¯ä»¥å¯¼å‡º CSV
- [ ] å¯ä»¥å¯¼å‡ºæ•°æ®åº“
- [ ] å¯ä»¥ä½¿ç”¨äº‘åŒæ­¥
- [ ] è®¾ç½®é¡µé¢æ˜¾ç¤º Pro çŠ¶æ€

### è´­ä¹°æµç¨‹
- [ ] ç‚¹å‡»å‡çº§æŒ‰é’®æ˜¾ç¤ºè´­ä¹°ç•Œé¢
- [ ] è´­ä¹°ç•Œé¢æ˜¾ç¤ºåŠŸèƒ½å¯¹æ¯”
- [ ] å¯ä»¥é€‰æ‹©å¹´è®¢é˜…æˆ–ç»ˆèº«ä¹°æ–­
- [ ] è´­ä¹°æˆåŠŸååŠŸèƒ½è§£é”

---

## ä¸‹ä¸€æ­¥æ“ä½œ

### 1. åœ¨ Xcode ä¸­æ·»åŠ æ–°æ–‡ä»¶ï¼ˆ5 åˆ†é’Ÿï¼‰
å°†ä»¥ä¸‹æ–‡ä»¶æ·»åŠ åˆ° Xcode é¡¹ç›®ï¼š
- Models/SubscriptionTier.swift
- Services/IAPManager.swift
- Services/SubscriptionManager.swift
- Views/PurchaseView.swift
- Views/UpgradePromptView.swift
- Views/DatabaseExportView.swift
- Products.storekit

### 2. é…ç½® StoreKit æµ‹è¯•ï¼ˆ1 åˆ†é’Ÿï¼‰
1. Edit Scheme â†’ Run â†’ Options
2. StoreKit Configuration: Products.storekit

### 3. ç¼–è¯‘å’Œæµ‹è¯•ï¼ˆ5 åˆ†é’Ÿï¼‰
1. âŒ˜ + B ç¼–è¯‘é¡¹ç›®
2. âŒ˜ + R è¿è¡Œåº”ç”¨
3. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

---

## æ³¨æ„äº‹é¡¹

1. **ç¼–è¯‘å‰å¿…é¡»æ·»åŠ æ–°æ–‡ä»¶**
   - å¦‚æœä¸æ·»åŠ æ–°æ–‡ä»¶ï¼Œä¼šæœ‰ç¼–è¯‘é”™è¯¯
   - ç‰¹åˆ«æ˜¯ SubscriptionManager å’Œ PurchaseView

2. **æµ‹è¯•ç¯å¢ƒé…ç½®**
   - å¿…é¡»é…ç½® StoreKit Configuration
   - å¦åˆ™è´­ä¹°åŠŸèƒ½æ— æ³•æµ‹è¯•

3. **çœŸæœºæµ‹è¯•**
   - äº‘åŒæ­¥åŠŸèƒ½éœ€è¦åœ¨çœŸæœºä¸Šæµ‹è¯•
   - è´­ä¹°åŠŸèƒ½å»ºè®®åœ¨çœŸæœºä¸Šå®Œæ•´æµ‹è¯•

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **ç¼–è¯‘é”™è¯¯**
   - æ£€æŸ¥æ‰€æœ‰æ–°æ–‡ä»¶æ˜¯å¦å·²æ·»åŠ 
   - æ¸…ç†æ„å»ºæ–‡ä»¶å¤¹ï¼ˆShift + âŒ˜ + Kï¼‰

2. **è¿è¡Œæ—¶é”™è¯¯**
   - æ£€æŸ¥ StoreKit Configuration æ˜¯å¦é…ç½®
   - æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

3. **åŠŸèƒ½ä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥è®¢é˜…çŠ¶æ€æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
   - éªŒè¯ environmentObject æ˜¯å¦æ­£ç¡®ä¼ é€’

---

## å®ŒæˆçŠ¶æ€

âœ… **æ‰€æœ‰ä»£ç ä¿®æ”¹å·²å®Œæˆ**
âœ… **æ‰€æœ‰åŠŸèƒ½å·²å®ç°**
âœ… **æ–‡æ¡£å·²æ›´æ–°**

**å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•ï¼** ğŸ‰

---

**ä¿®æ”¹äºº**: Kiro AI Assistant  
**ç‰ˆæœ¬**: 1.0.0  
**çŠ¶æ€**: å®Œæˆ
