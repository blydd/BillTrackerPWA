# å°ç»„ä»¶åŠŸèƒ½å®ç°æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

ä¸ºè®°è´¦åº”ç”¨æ·»åŠ ä¸»å±å¹•å°ç»„ä»¶ï¼Œè®©ç”¨æˆ·å¯ä»¥å¿«é€Ÿè®°å½•å¸¸ç”¨æ”¯å‡ºï¼Œæ— éœ€æ‰“å¼€åº”ç”¨ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ“± ä¸»å±å¹•å¿«é€Ÿè®°è´¦æŒ‰é’®
- âš¡ é¢„è®¾å¸¸ç”¨æ”¯å‡ºç±»å‹
- ğŸ¨ ç¾è§‚çš„å°ç»„ä»¶ç•Œé¢
- ğŸ“Š æ˜¾ç¤ºä»Šæ—¥/æœ¬æœˆæ”¯å‡ºç»Ÿè®¡
- âš™ï¸ å¯è‡ªå®šä¹‰é…ç½®

## ğŸ“‹ å·²å®Œæˆçš„ä»£ç æ–‡ä»¶

### 1. æ•°æ®æ¨¡å‹
- `Models/QuickExpenseItem.swift` - å¿«é€Ÿè®°è´¦é¡¹ç›®æ¨¡å‹

### 2. æœåŠ¡å±‚
- `Services/WidgetManager.swift` - å°ç»„ä»¶ç®¡ç†å™¨

### 3. ç•Œé¢å±‚
- `Views/WidgetConfigurationView.swift` - å°ç»„ä»¶é…ç½®ç•Œé¢

### 4. ä¸»åº”ç”¨é›†æˆ
- åœ¨è®¾ç½®é¡µé¢æ·»åŠ äº†"å°ç»„ä»¶é…ç½®"å…¥å£

## ğŸ”§ åœ¨ Xcode ä¸­éœ€è¦å®Œæˆçš„é…ç½®

### æ­¥éª¤ 1ï¼šæ·»åŠ  Widget Extension

1. **åˆ›å»º Widget Extension**
   ```
   File â†’ New â†’ Target â†’ Widget Extension
   Product Name: ExpenseTrackerWidget
   å‹¾é€‰ "Include Configuration Intent"
   ```

2. **é…ç½® App Groups**
   ```
   é€‰æ‹© ExpenseTrackerWidget target
   Signing & Capabilities â†’ æ·»åŠ  App Groups
   å‹¾é€‰ group.com.expensetracker.shared
   ```

### æ­¥éª¤ 2ï¼šå®ç°å°ç»„ä»¶ä»£ç 

åˆ›å»ºä»¥ä¸‹æ–‡ä»¶åœ¨ Widget Extension ä¸­ï¼š

#### ExpenseTrackerWidget.swift
```swift
import WidgetKit
import SwiftUI

struct ExpenseTrackerWidget: Widget {
    let kind: String = "ExpenseTrackerWidget"

    var body: some WidgetConfiguration {
        StaticConfiguration(kind: kind, provider: Provider()) { entry in
            ExpenseWidgetEntryView(entry: entry)
        }
        .configurationDisplayName("å¿«é€Ÿè®°è´¦")
        .description("åœ¨ä¸»å±å¹•å¿«é€Ÿè®°å½•å¸¸ç”¨æ”¯å‡º")
        .supportedFamilies([.systemSmall, .systemMedium])
    }
}

struct Provider: TimelineProvider {
    func placeholder(in context: Context) -> SimpleEntry {
        SimpleEntry(date: Date(), widgetData: WidgetManager.getWidgetData())
    }

    func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ()) {
        let entry = SimpleEntry(date: Date(), widgetData: WidgetManager.getWidgetData())
        completion(entry)
    }

    func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ()) {
        let currentDate = Date()
        let entry = SimpleEntry(date: currentDate, widgetData: WidgetManager.getWidgetData())
        
        // æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡
        let nextUpdate = Calendar.current.date(byAdding: .hour, value: 1, to: currentDate)!
        let timeline = Timeline(entries: [entry], policy: .after(nextUpdate))
        
        completion(timeline)
    }
}

struct SimpleEntry: TimelineEntry {
    let date: Date
    let widgetData: WidgetData
}

struct ExpenseWidgetEntryView: View {
    var entry: Provider.Entry
    @Environment(\.widgetFamily) var family

    var body: some View {
        switch family {
        case .systemSmall:
            SmallWidgetView(data: entry.widgetData)
        case .systemMedium:
            MediumWidgetView(data: entry.widgetData)
        default:
            SmallWidgetView(data: entry.widgetData)
        }
    }
}
```

#### SmallWidgetView.swift
```swift
import SwiftUI
import WidgetKit

struct SmallWidgetView: View {
    let data: WidgetData
    
    var body: some View {
        VStack(spacing: 8) {
            // æ ‡é¢˜
            HStack {
                Image(systemName: "plus.circle.fill")
                    .foregroundColor(.green)
                Text("å¿«é€Ÿè®°è´¦")
                    .font(.caption)
                    .fontWeight(.medium)
                Spacer()
            }
            
            // å¿«é€Ÿè®°è´¦æŒ‰é’®
            if let firstItem = data.configuration.selectedItems.first {
                Link(destination: URL(string: "expensetracker://quick?item=\(firstItem.title)")!) {
                    VStack(spacing: 4) {
                        Image(systemName: firstItem.icon)
                            .font(.title)
                            .foregroundColor(Color.fromName(firstItem.color))
                        
                        Text(firstItem.title)
                            .font(.caption)
                            .fontWeight(.medium)
                        
                        Text("Â¥\(firstItem.amount, specifier: "%.0f")")
                            .font(.caption2)
                            .foregroundColor(.secondary)
                    }
                }
                .buttonStyle(PlainButtonStyle())
            }
            
            Spacer()
            
            // æœ€è¿‘è®°è´¦ä¿¡æ¯
            if let recent = data.recentExpense {
                VStack(spacing: 2) {
                    Text("æœ€è¿‘è®°è´¦")
                        .font(.caption2)
                        .foregroundColor(.secondary)
                    
                    Text("\(recent.title) Â¥\(recent.amount, specifier: "%.0f")")
                        .font(.caption2)
                        .fontWeight(.medium)
                }
            }
        }
        .padding()
        .background(Color(.systemBackground))
    }
}
```

#### MediumWidgetView.swift
```swift
import SwiftUI
import WidgetKit

struct MediumWidgetView: View {
    let data: WidgetData
    
    var body: some View {
        VStack(spacing: 12) {
            // æ ‡é¢˜æ 
            HStack {
                Image(systemName: "plus.circle.fill")
                    .foregroundColor(.green)
                Text("å¿«é€Ÿè®°è´¦")
                    .font(.headline)
                    .fontWeight(.medium)
                Spacer()
                
                if let recent = data.recentExpense {
                    VStack(alignment: .trailing, spacing: 2) {
                        Text("æœ€è¿‘")
                            .font(.caption2)
                            .foregroundColor(.secondary)
                        Text("Â¥\(recent.amount, specifier: "%.0f")")
                            .font(.caption)
                            .fontWeight(.medium)
                    }
                }
            }
            
            // å¿«é€Ÿè®°è´¦æŒ‰é’®ç½‘æ ¼
            LazyVGrid(columns: Array(repeating: GridItem(.flexible()), count: 4), spacing: 8) {
                ForEach(Array(data.configuration.selectedItems.prefix(4))) { item in
                    Link(destination: URL(string: "expensetracker://quick?item=\(item.title)")!) {
                        VStack(spacing: 4) {
                            Image(systemName: item.icon)
                                .font(.title2)
                                .foregroundColor(Color.fromName(item.color))
                            
                            Text(item.title)
                                .font(.caption2)
                                .fontWeight(.medium)
                                .lineLimit(1)
                            
                            Text("Â¥\(item.amount, specifier: "%.0f")")
                                .font(.caption2)
                                .foregroundColor(.secondary)
                        }
                        .frame(maxWidth: .infinity)
                        .padding(.vertical, 8)
                        .background(Color(.systemGray6))
                        .cornerRadius(8)
                    }
                    .buttonStyle(PlainButtonStyle())
                }
            }
        }
        .padding()
        .background(Color(.systemBackground))
    }
}
```

### æ­¥éª¤ 3ï¼šé…ç½® URL Scheme

åœ¨ä¸»åº”ç”¨çš„ Info.plist ä¸­æ·»åŠ ï¼š
```xml
<key>CFBundleURLTypes</key>
<array>
    <dict>
        <key>CFBundleURLName</key>
        <string>com.expensetracker.quickadd</string>
        <key>CFBundleURLSchemes</key>
        <array>
            <string>expensetracker</string>
        </array>
    </dict>
</array>
```

### æ­¥éª¤ 4ï¼šå¤„ç† URL Scheme

åœ¨ ExpenseTrackerApp.swift ä¸­æ·»åŠ ï¼š
```swift
.onOpenURL { url in
    handleQuickExpense(url: url)
}

private func handleQuickExpense(url: URL) {
    guard url.scheme == "expensetracker",
          url.host == "quick",
          let components = URLComponents(url: url, resolvingAgainstBaseURL: false),
          let itemName = components.queryItems?.first(where: { $0.name == "item" })?.value else {
        return
    }
    
    Task {
        if let item = QuickExpenseItem.defaultItems.first(where: { $0.title == itemName }) {
            let success = await WidgetManager.shared.quickExpense(item)
            print(success ? "âœ… å¿«é€Ÿè®°è´¦æˆåŠŸ" : "âŒ å¿«é€Ÿè®°è´¦å¤±è´¥")
        }
    }
}
```

## ğŸ¯ ç”¨æˆ·ä½“éªŒ

### å°ç»„ä»¶åŠŸèƒ½
- **å°å°ºå¯¸**ï¼šæ˜¾ç¤ºä¸€ä¸ªä¸»è¦çš„å¿«é€Ÿè®°è´¦æŒ‰é’®
- **ä¸­ç­‰å°ºå¯¸**ï¼šæ˜¾ç¤º 4 ä¸ªå¿«é€Ÿè®°è´¦æŒ‰é’®ç½‘æ ¼
- **ç‚¹å‡»æŒ‰é’®**ï¼šç›´æ¥è®°è´¦ï¼Œæ— éœ€æ‰“å¼€åº”ç”¨
- **æ˜¾ç¤ºåé¦ˆ**ï¼šæ˜¾ç¤ºæœ€è¿‘è®°è´¦ä¿¡æ¯

### é…ç½®ç•Œé¢
- åœ¨åº”ç”¨è®¾ç½®ä¸­é…ç½®å°ç»„ä»¶
- é€‰æ‹©è¦æ˜¾ç¤ºçš„å¿«é€Ÿè®°è´¦é¡¹ç›®
- è‡ªå®šä¹‰é‡‘é¢å’Œç±»åˆ«
- æµ‹è¯•å¿«é€Ÿè®°è´¦åŠŸèƒ½

## ğŸ“± ä½¿ç”¨æµç¨‹

1. **é…ç½®å°ç»„ä»¶**ï¼šåœ¨åº”ç”¨è®¾ç½®ä¸­é€‰æ‹©è¦æ˜¾ç¤ºçš„é¡¹ç›®
2. **æ·»åŠ åˆ°ä¸»å±å¹•**ï¼šé•¿æŒ‰ä¸»å±å¹• â†’ æ·»åŠ å°ç»„ä»¶ â†’ é€‰æ‹©"æ ‡ç­¾è®°è´¦"
3. **å¿«é€Ÿè®°è´¦**ï¼šç‚¹å‡»å°ç»„ä»¶æŒ‰é’®å³å¯è®°è´¦
4. **æŸ¥çœ‹ç»“æœ**ï¼šæ‰“å¼€åº”ç”¨æŸ¥çœ‹è®°å½•çš„è´¦å•

## ğŸš€ ä¼˜åŠ¿ç‰¹ç‚¹

- âš¡ **æé€Ÿè®°è´¦**ï¼šæ— éœ€æ‰“å¼€åº”ç”¨
- ğŸ¯ **ç²¾å‡†å®šä½**ï¼šé¢„è®¾å¸¸ç”¨æ”¯å‡º
- ğŸ¨ **ç¾è§‚ç•Œé¢**ï¼šç¬¦åˆ iOS è®¾è®¡è§„èŒƒ
- âš™ï¸ **é«˜åº¦å¯é…ç½®**ï¼šç”¨æˆ·å¯è‡ªå®šä¹‰
- ğŸ“Š **æ•°æ®åŒæ­¥**ï¼šä¸ä¸»åº”ç”¨å®Œå…¨åŒæ­¥

è¿™ä¸ªå°ç»„ä»¶åŠŸèƒ½å°†å¤§å¤§æå‡ç”¨æˆ·çš„è®°è´¦æ•ˆç‡å’Œä½“éªŒï¼