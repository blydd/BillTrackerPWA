# 快速记账智能匹配方案

## 当前问题
- 归属人：总是选择第一个
- 支付方式：总是选择该归属人的第一个支付方式  
- 类别：简单的名称包含匹配

## 解决方案

### 方案一：智能匹配 + 用户偏好（推荐）

#### 1. 类别智能匹配
```swift
// 建立类别映射表
let categoryMappings = [
    "早餐": ["食", "餐饮", "早餐"],
    "午餐": ["食", "餐饮", "午餐"], 
    "晚餐": ["食", "餐饮", "晚餐"],
    "咖啡": ["娱乐", "饮品", "咖啡"],
    "交通": ["行", "交通", "出行"],
    "购物": ["购物", "日用品", "消费"]
]
```

#### 2. 支付方式智能选择
- **按类别匹配**：不同类别使用不同的默认支付方式
- **按金额匹配**：小额用现金/零钱，大额用信用卡
- **按时间匹配**：工作日用公司卡，周末用个人卡

#### 3. 归属人智能选择
- **单人模式**：只有一个归属人时自动选择
- **多人模式**：根据支付方式归属自动选择
- **用户偏好**：记住用户最常用的选择

### 方案二：用户配置模式

#### 快速记账项目配置
每个快速记账项目可以预设：
- 默认归属人
- 默认支付方式
- 默认类别
- 备选支付方式（主要的不可用时）

### 方案三：学习模式

#### 基于历史记录学习
- 分析用户过去的记账习惯
- 记录每种类型支出的常用支付方式
- 自动推荐最可能的组合

## 实现建议

### 立即可实现（简单）
1. **类别映射优化**：建立更准确的类别匹配表
2. **支付方式优先级**：为每个归属人设置默认支付方式
3. **用户偏好存储**：记住用户的选择偏好

### 中期实现（中等）
1. **快速记账项目配置**：每个项目可以预设归属人和支付方式
2. **智能推荐**：根据金额、时间、类别推荐支付方式

### 长期实现（复杂）
1. **机器学习**：基于历史数据训练推荐模型
2. **上下文感知**：根据位置、时间等推荐

## 推荐的第一步实现

### 1. 添加快速记账项目配置
```swift
struct QuickExpenseConfig {
    let title: String
    let amount: Decimal
    let preferredOwnerId: UUID?      // 偏好归属人
    let preferredPaymentMethodId: UUID? // 偏好支付方式
    let categoryKeywords: [String]    // 类别关键词
    let icon: String
    let color: String
}
```

### 2. 智能匹配逻辑
```swift
func findBestMatch(config: QuickExpenseConfig) -> (owner: Owner, paymentMethod: PaymentMethod, category: Category) {
    // 1. 优先使用预设的归属人和支付方式
    // 2. 如果预设不可用，使用智能匹配
    // 3. 最后使用默认选择
}
```

这样既保持了快速记账的便利性，又提供了准确性和个性化。