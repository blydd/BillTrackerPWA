# æ–‡ä»¶æ›¿æ¢æŒ‡å—

## ğŸ“„ æ–‡ä»¶ 1ï¼šExpenseTrackerWidgetExtension.swift

**æ“ä½œ**ï¼šåˆ é™¤ Xcode è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œåˆ›å»ºæ–°æ–‡ä»¶å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹

```swift
import WidgetKit
import SwiftUI

/// å¿«é€Ÿè®°è´¦å°ç»„ä»¶æ‰©å±•å…¥å£
@main
struct ExpenseTrackerWidgetBundle: WidgetBundle {
    var body: some Widget {
        ExpenseTrackerWidget()
    }
}

/// å¿«é€Ÿè®°è´¦å°ç»„ä»¶
struct ExpenseTrackerWidget: Widget {
    let kind: String = "ExpenseTrackerWidget"

    var body: some WidgetConfiguration {
        StaticConfiguration(kind: kind, provider: ExpenseTrackerProvider()) { entry in
            ExpenseTrackerWidgetEntryView(entry: entry)
        }
        .configurationDisplayName("æ ‡ç­¾è®°è´¦")
        .description("å¿«é€Ÿè®°å½•æ—¥å¸¸æ”¯å‡º")
        .supportedFamilies([.systemSmall, .systemMedium])
    }
}

/// å°ç»„ä»¶æ•°æ®æä¾›å™¨
struct ExpenseTrackerProvider: TimelineProvider {
    func placeholder(in context: Context) -> ExpenseTrackerEntry {
        ExpenseTrackerEntry(date: Date(), quickItems: QuickExpenseItem.defaultItems)
    }

    func getSnapshot(in context: Context, completion: @escaping (ExpenseTrackerEntry) -> ()) {
        let entry = ExpenseTrackerEntry(date: Date(), quickItems: QuickExpenseItem.defaultItems)
        completion(entry)
    }

    func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ()) {
        let currentDate = Date()
        let entry = ExpenseTrackerEntry(date: currentDate, quickItems: QuickExpenseItem.defaultItems)
        
        // æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡
        let nextUpdate = Calendar.current.date(byAdding: .hour, value: 1, to: currentDate)!
        let timeline = Timeline(entries: [entry], policy: .after(nextUpdate))
        
        completion(timeline)
    }
}

/// å°ç»„ä»¶æ—¶é—´çº¿æ¡ç›®
struct ExpenseTrackerEntry: TimelineEntry {
    let date: Date
    let quickItems: [QuickExpenseItem]
}

/// å°ç»„ä»¶ä¸»è§†å›¾
struct ExpenseTrackerWidgetEntryView: View {
    var entry: ExpenseTrackerProvider.Entry
    @Environment(\.widgetFamily) var family

    var body: some View {
        switch family {
        case .systemSmall:
            SmallWidgetView(quickItems: entry.quickItems)
        case .systemMedium:
            MediumWidgetView(quickItems: entry.quickItems)
        default:
            SmallWidgetView(quickItems: entry.quickItems)
        }
    }
}

/// å°å°ºå¯¸å°ç»„ä»¶è§†å›¾
struct SmallWidgetView: View {
    let quickItems: [QuickExpenseItem]
    
    var body: some View {
        VStack(spacing: 8) {
            // æ ‡é¢˜æ 
            HStack {
                Image(systemName: "plus.circle.fill")
                    .foregroundColor(.green)
                    .font(.caption)
                Text("å¿«é€Ÿè®°è´¦")
                    .font(.caption)
                    .fontWeight(.medium)
                Spacer()
            }
            
            // ä¸»è¦å¿«é€Ÿè®°è´¦æŒ‰é’®
            if let firstItem = quickItems.first {
                Link(destination: URL(string: "expensetracker://quick?item=\(firstItem.title)")!) {
                    VStack(spacing: 6) {
                        Image(systemName: firstItem.icon)
                            .font(.title)
                            .foregroundColor(Color.fromName(firstItem.color))
                        
                        Text(firstItem.title)
                            .font(.headline)
                            .fontWeight(.medium)
                        
                        Text("Â¥\(NSDecimalNumber(decimal: firstItem.amount).intValue)")
                            .font(.caption)
                            .foregroundColor(.secondary)
                    }
                    .frame(maxWidth: .infinity)
                    .padding(.vertical, 8)
                    .background(Color(.systemGray6))
                    .cornerRadius(12)
                }
                .buttonStyle(PlainButtonStyle())
            }
            
            Spacer()
        }
        .padding(12)
        .background(Color(.systemBackground))
        .containerBackground(for: .widget) {
            Color(.systemBackground)
        }
    }
}

/// ä¸­ç­‰å°ºå¯¸å°ç»„ä»¶è§†å›¾
struct MediumWidgetView: View {
    let quickItems: [QuickExpenseItem]
    
    var body: some View {
        VStack(spacing: 12) {
            // æ ‡é¢˜æ 
            HStack {
                Image(systemName: "plus.circle.fill")
                    .foregroundColor(.green)
                    .font(.headline)
                Text("å¿«é€Ÿè®°è´¦")
                    .font(.headline)
                    .fontWeight(.medium)
                Spacer()
            }
            
            // å¿«é€Ÿè®°è´¦æŒ‰é’®ç½‘æ ¼
            LazyVGrid(columns: Array(repeating: GridItem(.flexible(), spacing: 8), count: 4), spacing: 8) {
                ForEach(Array(quickItems.prefix(4).enumerated()), id: \.offset) { index, item in
                    Link(destination: URL(string: "expensetracker://quick?item=\(item.title)")!) {
                        VStack(spacing: 4) {
                            Image(systemName: item.icon)
                                .font(.title2)
                                .foregroundColor(Color.fromName(item.color))
                            
                            Text(item.title)
                                .font(.caption)
                                .fontWeight(.medium)
                                .lineLimit(1)
                            
                            Text("Â¥\(NSDecimalNumber(decimal: item.amount).intValue)")
                                .font(.caption2)
                                .foregroundColor(.secondary)
                        }
                        .frame(maxWidth: .infinity)
                        .padding(.vertical, 8)
                        .background(Color(.systemGray6))
                        .cornerRadius(8)
                    }
                    .buttonStyle(PlainButtonStyle())
                }
            }
            
            Spacer(minLength: 0)
        }
        .padding(12)
        .background(Color(.systemBackground))
        .containerBackground(for: .widget) {
            Color(.systemBackground)
        }
    }
}

/// å¿«é€Ÿè®°è´¦é¡¹ç›®æ¨¡å‹ï¼ˆå°ç»„ä»¶ç‰ˆæœ¬ï¼‰
struct QuickExpenseItem {
    let title: String
    let amount: Decimal
    let category: String
    let icon: String
    let color: String
    
    static let defaultItems: [QuickExpenseItem] = [
        QuickExpenseItem(title: "æ—©é¤", amount: 15, category: "é£Ÿ", icon: "cup.and.saucer.fill", color: "orange"),
        QuickExpenseItem(title: "åˆé¤", amount: 25, category: "é£Ÿ", icon: "fork.knife", color: "green"),
        QuickExpenseItem(title: "æ™šé¤", amount: 35, category: "é£Ÿ", icon: "takeoutbag.and.cup.and.straw.fill", color: "red"),
        QuickExpenseItem(title: "å’–å•¡", amount: 20, category: "å¨±ä¹", icon: "cup.and.saucer.fill", color: "brown"),
        QuickExpenseItem(title: "äº¤é€š", amount: 10, category: "è¡Œ", icon: "car.fill", color: "blue"),
        QuickExpenseItem(title: "è´­ç‰©", amount: 100, category: "è´­ç‰©", icon: "bag.fill", color: "purple")
    ]
}

extension Color {
    /// æ ¹æ®é¢œè‰²åç§°è·å–é¢œè‰²
    static func fromName(_ name: String) -> Color {
        switch name.lowercased() {
        case "orange": return .orange
        case "green": return .green
        case "red": return .red
        case "brown": return .brown
        case "blue": return .blue
        case "purple": return .purple
        case "pink": return .pink
        case "yellow": return .yellow
        case "gray": return .gray
        default: return .primary
        }
    }
}

#Preview(as: .systemSmall) {
    ExpenseTrackerWidget()
} timeline: {
    ExpenseTrackerEntry(date: .now, quickItems: QuickExpenseItem.defaultItems)
}

#Preview(as: .systemMedium) {
    ExpenseTrackerWidget()
} timeline: {
    ExpenseTrackerEntry(date: .now, quickItems: QuickExpenseItem.defaultItems)
}
```

## ğŸ“„ æ–‡ä»¶ 2ï¼šInfo.plist

**æ“ä½œ**ï¼šæ£€æŸ¥ç°æœ‰ Info.plistï¼Œå¦‚æœå†…å®¹ä¸å®Œæ•´åˆ™æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>CFBundleDisplayName</key>
	<string>æ ‡ç­¾è®°è´¦</string>
	<key>CFBundleExecutable</key>
	<string>$(EXECUTABLE_NAME)</string>
	<key>CFBundleIdentifier</key>
	<string>$(PRODUCT_BUNDLE_IDENTIFIER)</string>
	<key>CFBundleInfoDictionaryVersion</key>
	<string>6.0</string>
	<key>CFBundleName</key>
	<string>$(PRODUCT_NAME)</string>
	<key>CFBundlePackageType</key>
	<string>$(PRODUCT_BUNDLE_PACKAGE_TYPE)</string>
	<key>CFBundleShortVersionString</key>
	<string>1.0</string>
	<key>CFBundleVersion</key>
	<string>1</string>
	<key>NSExtension</key>
	<dict>
		<key>NSExtensionPointIdentifier</key>
		<string>com.apple.widgetkit-extension</string>
	</dict>
</dict>
</plist>
```

## ğŸ“„ æ–‡ä»¶ 3ï¼šExpenseTrackerWidgetExtension.entitlements

**æ“ä½œ**ï¼šåˆ›å»ºæ–°çš„ Property List æ–‡ä»¶ï¼Œå‘½åä¸º `ExpenseTrackerWidgetExtension.entitlements`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>com.apple.security.application-groups</key>
	<array>
		<string>group.com.bgt.TagBill.shared</string>
	</array>
</dict>
</plist>
```

## âœ… å®Œæˆåçš„æ–‡ä»¶ç»“æ„

```
ExpenseTrackerWidgetExtension/
â”œâ”€â”€ ExpenseTrackerWidgetExtension.swift     â† æ–°åˆ›å»ºï¼ŒåŒ…å«æˆ‘çš„ä»£ç 
â”œâ”€â”€ Assets.xcassets/                        â† Xcode è‡ªåŠ¨ç”Ÿæˆï¼Œä¿ç•™
â”œâ”€â”€ Info.plist                             â† æ£€æŸ¥å¹¶æ›¿æ¢å†…å®¹
â””â”€â”€ ExpenseTrackerWidgetExtension.entitlements â† æ–°åˆ›å»º
```

## ğŸ¯ æ“ä½œé¡ºåº

1. **åˆ é™¤** Xcode è‡ªåŠ¨ç”Ÿæˆçš„ `ExpenseTrackerWidgetExtension.swift`
2. **åˆ›å»º** æ–°çš„ `ExpenseTrackerWidgetExtension.swift` å¹¶ç²˜è´´æˆ‘çš„ä»£ç 
3. **æ£€æŸ¥** `Info.plist` å†…å®¹ï¼Œå¿…è¦æ—¶æ›¿æ¢
4. **åˆ›å»º** `ExpenseTrackerWidgetExtension.entitlements` æ–‡ä»¶
5. **é…ç½®** Target è®¾ç½®ä¸­çš„ Entitlements è·¯å¾„

æŒ‰ç…§è¿™ä¸ªé¡ºåºæ“ä½œå°±å¯ä»¥äº†ï¼