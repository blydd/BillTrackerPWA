# 支付方式统计显示功能说明

## ✅ 功能更新

### 修改内容
在统计页面的"按支付方式统计"部分，支付方式名称现在显示为：
**"归属人-支付方式名称"** 格式

### 显示效果

#### 修改前
```
微信支付     ¥1,250
支付宝       ¥800
信用卡       ¥2,100
现金         ¥300
```

#### 修改后
```
张三-微信支付   ¥1,250
张三-支付宝     ¥800
李四-信用卡     ¥2,100
张三-现金       ¥300
```

## 🎯 实现原理

### 代码修改
在 `StatisticsViewModel.swift` 中修改支付方式统计逻辑：

```swift
// 修改前
if pmStats[paymentMethod.name] == nil {
    pmStats[paymentMethod.name] = [:]
}
pmStats[paymentMethod.name]?[actualTransactionType, default: 0] += amount

// 修改后
let ownerName = ownerDict[bill.ownerId] ?? "未知"
let paymentMethodDisplayName = "\(ownerName)-\(paymentMethod.name)"

if pmStats[paymentMethodDisplayName] == nil {
    pmStats[paymentMethodDisplayName] = [:]
}
pmStats[paymentMethodDisplayName]?[actualTransactionType, default: 0] += amount
```

### 数据处理逻辑
1. **获取归属人名称**：通过 `bill.ownerId` 从 `ownerDict` 中查找归属人姓名
2. **格式化显示名称**：将归属人和支付方式名称用"-"连接
3. **异常处理**：如果找不到归属人，显示"未知"
4. **统计聚合**：按新的显示名称进行统计聚合

## 📱 用户体验改进

### 优势
1. **清晰区分**：多人使用时能清楚看到每个人的支付方式使用情况
2. **便于分析**：可以分析不同人的消费习惯和支付偏好
3. **避免混淆**：同名支付方式（如多人都有微信支付）不会混在一起

### 使用场景
- **家庭记账**：区分家庭成员的支付方式使用情况
- **团队记账**：分析团队成员的消费模式
- **个人多账户**：管理个人的多个支付账户

## 🔍 测试验证

### 测试步骤
1. 确保有多个归属人和支付方式
2. 创建不同归属人使用不同支付方式的账单
3. 进入统计页面 → 按支付方式统计
4. 验证显示格式是否为"归属人-支付方式名称"

### 预期结果
- ✅ 支付方式名称前显示归属人信息
- ✅ 格式统一为"归属人-支付方式名称"
- ✅ 统计数据准确无误
- ✅ 排序按金额从高到低

## 💡 技术细节

### 数据流程
1. **账单数据**：包含 `ownerId` 和 `paymentMethodId`
2. **关联查询**：通过 ID 查找归属人和支付方式信息
3. **名称组合**：格式化为显示名称
4. **统计聚合**：按显示名称分组统计
5. **UI 展示**：在统计页面显示结果

### 兼容性
- ✅ 兼容现有数据结构
- ✅ 不影响其他统计功能
- ✅ 支持数据缺失的异常情况

这个修改让支付方式统计更加清晰和实用，特别适合多人使用的场景！