# 编译错误修复指南

## 当前错误分析

错误信息显示：
```
Static subscript 'subscript(_:enclosingInstance:wrapped:storage:)' is not available due to missing import of defining module 'Combine'
```

这是 Xcode 的缓存问题，不是代码问题。

## 解决方案

### 方法 1：清理构建缓存（推荐）

1. 在 Xcode 菜单栏选择：**Product** → **Clean Build Folder**
2. 或者按快捷键：**Shift + ⌘ + K**
3. 等待清理完成
4. 重新编译：**⌘ + B**

### 方法 2：删除 DerivedData

1. 关闭 Xcode
2. 在 Finder 中按 **⌘ + Shift + G**
3. 输入：`~/Library/Developer/Xcode/DerivedData`
4. 找到 ExpenseTracker 相关的文件夹并删除
5. 重新打开 Xcode
6. 编译项目

### 方法 3：重启 Xcode

有时候简单的重启就能解决：
1. 完全退出 Xcode（⌘ + Q）
2. 重新打开项目
3. 编译

### 方法 4：检查文件是否正确添加

确保所有新文件都已添加到项目：

1. 在 Xcode 左侧项目导航器中，点击每个新文件
2. 在右侧 **File Inspector** 中（⌘ + Option + 1）
3. 确认 **Target Membership** 中 **ExpenseTracker** 已勾选

需要检查的文件：
- ✅ Models/SubscriptionTier.swift
- ✅ Services/IAPManager.swift
- ✅ Services/SubscriptionManager.swift
- ✅ Views/PurchaseView.swift
- ✅ Views/UpgradePromptView.swift
- ✅ Views/DatabaseExportView.swift

---

## 如果还是报错

### 检查 import 语句

确保以下文件有正确的 import：

**Services/SubscriptionManager.swift**:
```swift
import Foundation
import Combine
import StoreKit  // ← 必须有这个
```

**Services/IAPManager.swift**:
```swift
import Foundation
import StoreKit  // ← 必须有这个
```

**ViewModels/ExportViewModel.swift**:
```swift
import Foundation
import Combine  // ← 必须有这个
```

---

## 完整的清理步骤

如果上述方法都不行，执行完整清理：

```bash
# 1. 关闭 Xcode

# 2. 在终端执行以下命令
cd ~/Library/Developer/Xcode/DerivedData
rm -rf *

# 3. 重新打开 Xcode

# 4. Clean Build Folder (Shift + ⌘ + K)

# 5. 重新编译 (⌘ + B)
```

---

## 验证修复成功

编译成功后应该：
- ✅ 0 errors
- ⚠️ 可能有一些警告（正常）
- ✅ 可以运行应用

---

## 如果特定文件报错

### IAPManager 错误

如果 IAPManager 报错 "Type 'IAPManager' does not conform to protocol 'ObservableObject'"：

在 IAPManager.swift 顶部确保有：
```swift
import Foundation
import StoreKit
```

### SubscriptionManager 错误

如果 SubscriptionManager 报错找不到 Transaction 或 VerificationResult：

确保有：
```swift
import Foundation
import Combine
import StoreKit
```

---

## 最后的办法

如果所有方法都不行：

1. 从项目中移除所有新添加的文件（不删除文件，只是从项目中移除）
2. Clean Build Folder
3. 重新添加这些文件到项目
4. 确保勾选 Target Membership
5. 重新编译

---

## 需要帮助？

如果还是无法解决，请提供：
1. 具体的错误信息截图
2. 哪个文件报错
3. 错误的完整描述

我会帮你进一步排查！
