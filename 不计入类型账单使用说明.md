# 不计入类型账单使用说明

## 💡 "不计入"类型的作用

"不计入"类型的账单会**更新支付方式余额**，但**不计入收支统计**。

典型使用场景：
- 信用卡还款
- 账户间转账
- 余额调整

## 📝 如何正确使用

### 场景 1：还信用卡

**操作步骤**：
1. 选择"不计入"类型
2. 输入金额：**正数**（例如：1000）
3. 选择信用卡支付方式
4. 保存

**效果**：
- ✅ 信用卡欠费减少 1000
- ✅ 信用卡可用额度增加 1000
- ❌ 不计入收支统计

### 场景 2：信用卡消费（不计入统计）

**操作步骤**：
1. 选择"不计入"类型
2. 输入金额：**负数**（例如：-500）
3. 选择信用卡支付方式
4. 保存

**效果**：
- ✅ 信用卡欠费增加 500
- ✅ 信用卡可用额度减少 500
- ❌ 不计入收支统计

### 场景 3：储蓄账户存入

**操作步骤**：
1. 选择"不计入"类型
2. 输入金额：**正数**（例如：2000）
3. 选择储蓄账户
4. 保存

**效果**：
- ✅ 储蓄账户余额增加 2000
- ❌ 不计入收支统计

### 场景 4：储蓄账户取出

**操作步骤**：
1. 选择"不计入"类型
2. 输入金额：**负数**（例如：-300）
3. 选择储蓄账户
4. 保存

**效果**：
- ✅ 储蓄账户余额减少 300
- ❌ 不计入收支统计

## 🔢 金额符号规则

### 信用卡（信贷方式）

| 操作 | 输入金额 | 欠费变化 | 可用额度变化 |
|------|---------|---------|-------------|
| 还款 | **+1000** | 减少 1000 | 增加 1000 |
| 消费 | **-500** | 增加 500 | 减少 500 |

**计算公式**：
```
新欠费 = 旧欠费 - 输入金额
可用额度 = 信用额度 - 新欠费
```

**示例**：
```
假设：信用额度 10000，当前欠费 3000，可用额度 7000

还款 +1000：
  新欠费 = 3000 - 1000 = 2000
  可用额度 = 10000 - 2000 = 8000 ✅

消费 -500：
  新欠费 = 3000 - (-500) = 3500
  可用额度 = 10000 - 3500 = 6500 ✅
```

### 储蓄账户

| 操作 | 输入金额 | 余额变化 |
|------|---------|---------|
| 存入 | **+2000** | 增加 2000 |
| 取出 | **-300** | 减少 300 |

**计算公式**：
```
新余额 = 旧余额 + 输入金额
```

## 🐛 如果余额没有变化

### 检查清单

1. **检查金额符号**
   - 还款/存入 → 应该输入**正数**
   - 消费/取出 → 应该输入**负数**

2. **检查支付方式**
   - 确认选择了正确的支付方式
   - 确认支付方式的归属人与账单归属人一致

3. **检查账单是否保存成功**
   - 查看账单列表，确认账单已创建
   - 查看账单详情，确认金额正确

4. **刷新支付方式列表**
   - 返回支付方式管理页面
   - 查看余额是否已更新

## 💡 UI 改进建议

为了让用户更容易理解，可以考虑：

1. **添加提示文本**
   ```
   "不计入"类型说明：
   - 正数：还款/存入（增加可用额度/余额）
   - 负数：消费/取出（减少可用额度/余额）
   ```

2. **添加快捷按钮**
   ```
   [还款] [消费]
   点击自动设置正确的符号
   ```

3. **显示预期效果**
   ```
   当前欠费：3000
   输入金额：+1000
   预期欠费：2000 ✅
   ```

## 🔧 如果需要修改代码

如果你想改变默认行为，可以修改 `BillFormView.swift`：

```swift
// 当前：用户需要手动输入正负号
case .excluded:
    // 不计入：保持用户输入的符号
    break

// 可以改为：根据操作类型自动设置符号
case .excluded:
    // 如果是还款/存入，转为正数
    // 如果是消费/取出，转为负数
    // 需要添加UI让用户选择操作类型
```

## ✅ 验证步骤

1. 记录当前信用卡欠费（例如：3000）
2. 创建"不计入"账单，输入 +1000
3. 保存后，查看信用卡欠费应该变为 2000
4. 如果没有变化，检查上述清单

---

**提示**：如果还是有问题，请告诉我：
1. 你输入的金额是多少（包括符号）
2. 信用卡当前的欠费和额度
3. 保存后的欠费和额度

我会帮你进一步诊断！
