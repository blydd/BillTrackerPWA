# ExpenseTracker - 账单管理应用

一个功能完善的 iOS 账单管理应用，支持多人账单记录、智能支付方式管理、数据统计分析和应用内购买。

## 系统要求

- iOS 15.0+
- Xcode 14.0+
- Swift 5.7+

## 核心功能

### 📝 账单管理
- **三种交易类型**：支出、收入、不计入
- **多标签支持**：每个账单可添加多个类型标签
- **智能余额更新**：创建/修改/删除账单自动更新支付方式余额
- **按日分组显示**：每日自动汇总收入、支出和不计入金额
- **筛选功能**：
  - 按交易类型筛选（支出/收入/不计入）
  - 按账户类型筛选（信贷方式/储蓄方式）
  - 按归属人筛选
  - 按账单类型筛选（AND 逻辑）
  - 按支付方式筛选
  - 按日期范围筛选
- **详细日志**：余额更新过程完整记录，便于问题排查

### 💳 支付方式管理
- **信贷方式**：信用卡、花呗、白条等
  - 信用额度管理
  - 欠费追踪（支持溢缴款，欠费可为负数）
  - 账单日设置
  - 自动计算可用额度
- **储蓄方式**：微信、支付宝、银行卡等
  - 余额管理
  - 实时更新
- **归属人隔离**：每个人独立的支付方式，防止误操作
- **自定义排序**：长按拖动调整支付方式显示顺序
- **智能显示**：创建账单时只显示对应归属人的支付方式

### 👥 多人账单
- 支持多个归属人（默认：男主、女主）
- 每个归属人独立的支付方式
- 按归属人统计支出
- **自定义排序**：长按拖动调整归属人显示顺序

### 📊 统计分析
- **总览统计**：总收入、总支出、净收入
- **多维度统计**：
  - 按账单类型统计（支出/收入/不计入）
  - 按归属人统计
  - 按支付方式统计
- **Tab 切换**：快速切换不同统计维度和交易类型
- **时间范围筛选**：
  - 本月、上月、今年、全部
  - 自定义日期范围
- **点击查看详情**：点击统计数据查看对应的账单列表
- **详情操作**：在详情页面可直接编辑或删除账单

### 📤 数据导入导出
- **导出功能**：
  - 导出为 CSV 格式
  - 支持筛选后导出
  - 包含完整账单信息（日期、金额、交易类型、账单类型、归属人、支付方式、备注）
  - 文件名包含时间戳
- **导入功能**：
  - 支持 CSV 格式导入
  - 自动匹配账单类型、归属人、支付方式
  - 兼容新旧格式（有无交易类型列）
  - 导入前预览数据

### 🎯 账单类型管理
- **丰富的预设类型**：
  - 支出类型（31个）：衣、食、外卖、下馆子、超市、赶集、转给妈、住、电费、水费、燃气、房租、行、加油、停车费、轿车、摩托、购物、京东、拼多多、淘宝、米乐、教育、医疗、娱乐、电影、保险、话费、人情、老家装修、其他
  - 收入类型（3个）：工资、保险理赔、其他
  - 不计入类型（2个）：还信用卡、对冲
- **自定义排序**：长按拖动调整账单类型显示顺序
- **灵活管理**：可添加、编辑、删除账单类型

### 🔄 初始化功能
- 一键创建基础数据
- 为"男主"和"女主"各生成一套完整的支付方式
- 预设常用账单类型和归属人
- 支持重新初始化（会清空所有数据）

### 💎 应用内购买（IAP）
- **免费版限制**：
  - 最多 500 条账单
  - 最多 2 个归属人
  - 无法导出数据
- **Pro 版功能**：
  - 无限账单记录
  - 无限归属人
  - 数据导出功能
  - 一次购买，永久使用
- 详见：[免费账户限制说明](./免费账户限制说明.md)

### 🎨 用户体验
- **紧凑布局**：优化标签和按钮间距，提升信息密度
- **智能匹配**：快速记账功能，智能匹配历史记录
- **iOS 15+ 兼容**：完美支持 iOS 15 及以上版本
- **响应式设计**：适配不同屏幕尺寸
- **实时反馈**：操作即时响应，状态清晰可见

## 使用教程

### 初次使用
1. 打开应用，进入"设置"页面
2. 点击"初始化"创建基础数据（账单类型、归属人、支付方式）
3. 根据需要在"设置"中管理账单类型、归属人和支付方式

### 添加账单
1. 在"账单"页面点击右上角 ➕
2. 选择交易类型（支出/收入/不计入）
3. 输入金额
4. 选择归属人
5. 选择支付方式（只显示该归属人的支付方式）
6. 选择账单类型（可多选）
7. 可选填写备注
8. 点击"保存"

### 管理支付方式
1. 进入"设置" → "支付方式管理"
2. 选择账户类型（信贷/储蓄）
3. 选择归属人（顶部横向滚动按钮）
4. 点击 ➕ 添加新的支付方式
5. 点击"编辑"修改现有支付方式

### 查看统计
1. 进入"统计"页面
2. 选择时间范围
3. 查看各维度的统计数据

## 安装到手机

### 方法一：Xcode 直接安装（推荐，免费）

**前提条件**
- Mac 电脑 + Xcode
- iPhone 数据线
- Apple ID（免费账号即可）

**步骤**

1. 用数据线连接 iPhone 到 Mac

2. 在 Xcode 中打开项目
   ```bash
   open ExpenseTracker.xcodeproj
   ```

3. 配置签名
   - 选择项目 → ExpenseTracker target
   - 点击 "Signing & Capabilities"
   - 勾选 "Automatically manage signing"
   - 选择你的 Apple ID

4. 选择设备并运行
   - 在 Xcode 顶部选择你的 iPhone
   - 点击 ▶️ 运行

5. 信任开发者（首次运行）
   - iPhone：设置 → 通用 → VPN与设备管理
   - 点击你的 Apple ID → 信任

**注意**：免费账号应用只能运行 7 天，之后需要重新安装。

### 方法二：TestFlight（需要开发者账号）

如果有 Apple Developer Program 账号（$99/年）：
- 应用可运行 90 天
- 可分享给其他测试用户

## 技术栈

- **UI 框架**：SwiftUI
- **架构模式**：MVVM
- **数据存储**：SQLite（本地数据库）
- **响应式编程**：Combine
- **应用内购买**：StoreKit 2
- **最低版本**：iOS 15.0+

## 数据存储

应用使用 SQLite 数据库存储数据，数据保存在本地设备上。

**数据安全**：
- 数据仅存储在本地，不会上传到云端
- 支持数据导出备份（Pro 版）
- 卸载应用会清除所有数据
- 建议定期导出数据备份

**数据库特性**：
- 支持事务处理，确保数据一致性
- 自动数据库迁移，支持版本升级
- 完整的外键约束和索引优化

## 项目结构

```
ExpenseTracker/
├── Models/              # 数据模型
│   ├── Bill.swift       # 账单模型
│   ├── BillCategory.swift  # 账单类型模型
│   ├── Owner.swift      # 归属人模型
│   └── PaymentMethod.swift # 支付方式模型
├── ViewModels/          # 业务逻辑层
│   ├── BillViewModel.swift
│   ├── CategoryViewModel.swift
│   ├── OwnerViewModel.swift
│   ├── PaymentMethodViewModel.swift
│   ├── StatisticsViewModel.swift
│   └── ExportViewModel.swift
├── Views/               # 界面视图层
│   ├── BillListView.swift
│   ├── BillFormView.swift
│   ├── StatisticsView.swift
│   ├── SettingsView.swift
│   └── ...
├── Repository/          # 数据持久化层
│   ├── DataRepository.swift
│   ├── SQLiteRepository.swift
│   └── UserDefaultsRepository.swift
└── Services/            # 服务层
    ├── SubscriptionManager.swift
    └── ...
```

## 特色功能

### 🔐 智能余额管理
- **自动更新**：创建/修改/删除账单自动更新支付方式余额
- **错误回滚**：操作失败自动回滚余额变化，确保数据一致性
- **详细日志**：完整记录余额更新过程，便于问题排查
- **信贷方式**：
  - 自动计算可用额度（信用额度 - 欠费）
  - 支持溢缴款（欠费可为负数）
  - 超额提醒
- **储蓄方式**：实时余额追踪

### 👤 归属人隔离
- 每个归属人独立的支付方式
- 创建账单时只显示对应归属人的支付方式
- 防止误操作他人账户
- 支持自定义排序

### 🏷️ 灵活的账单类型
- **支出**：日常消费，金额为负数，计入支出统计
- **收入**：工资等收入，金额为正数，计入收入统计
- **不计入**：信用卡还款、账户转账等
  - 更新支付方式余额
  - 不计入收支统计
  - 每日汇总单独显示
  - 详见：[不计入类型账单使用说明](./不计入类型账单使用说明.md)

### 💳 信用卡溢缴款支持
- 还款金额可超过欠费
- 欠费为负数表示溢缴款
- 可用额度自动增加
- 详见：[信用卡溢缴款功能说明](./信用卡溢缴款功能说明.md)

### 🔍 强大的筛选功能
- **多条件筛选**：支持同时按多个维度筛选
- **AND 逻辑**：账单类型筛选使用 AND 逻辑，必须满足所有选中条件
- **智能缓存**：筛选结果自动缓存，提升性能
- **筛选导出**：支持导出筛选后的账单数据

### 📊 统计详情查看
- 点击统计数据查看对应账单列表
- 支持在详情页面直接编辑或删除账单
- 数据变化后自动刷新统计

## 开发计划

- [ ] iCloud 同步支持
- [ ] 数据库自动备份
- [ ] 更多图表展示（饼图、折线图）
- [ ] 预算管理功能
- [ ] 账单搜索功能
- [ ] 定期账单提醒
- [ ] 账单附件（照片、发票）
- [ ] 多币种支持
- [ ] 深色模式优化

## 相关文档

- [快速开始指南](./QUICK_START.md)
- [集成指南](./INTEGRATION_GUIDE.md)
- [IAP 功能说明](./IAP_README.md)
- [IAP 架构设计](./IAP_ARCHITECTURE.md)
- [CloudKit 配置指南](./CloudKit配置指南.md)
- [免费账户限制说明](./免费账户限制说明.md)
- [不计入类型账单使用说明](./不计入类型账单使用说明.md)
- [信用卡溢缴款功能说明](./信用卡溢缴款功能说明.md)
- [更新日志](./CHANGELOG.md)

## 贡献

欢迎提交 Issue 和 Pull Request！

## License

MIT License