# 免费开发者账户限制说明

## 问题

使用个人免费 Apple 开发者账户时，遇到以下错误：

```
Cannot create a iOS App Development provisioning profile for "com.bgt.TagBill". 
Personal development teams, including "国通 薄", do not support the Apple Pay and iCloud capabilities.
```

## 原因

**Apple 个人免费账户的限制**：
- ❌ 不支持 iCloud/CloudKit
- ❌ 不支持 Apple Pay
- ❌ 不支持推送通知（生产环境）
- ❌ 不支持某些高级功能
- ⚠️ 真机签名每 7 天过期

## 当前状态

### ✅ 可以使用的功能

**核心功能**（无需付费账户）：
- ✅ 账单管理（创建、编辑、删除）
- ✅ 统计分析
- ✅ 数据导出（CSV）
- ✅ 本地数据存储（SQLite）
- ✅ 所有 UI 功能
- ✅ 筛选和搜索
- ✅ 真机调试和测试

**IAP 功能**（可以测试）：
- ✅ StoreKit 测试环境
- ✅ 购买流程 UI
- ✅ 订阅管理逻辑
- ✅ 权限检查
- ⚠️ 需要使用 StoreKit Configuration 文件测试

### ❌ 暂时无法使用的功能

**需要付费账户**：
- ❌ iCloud 云同步
- ❌ CloudKit 数据同步
- ❌ 真实的 IAP 购买（App Store）
- ❌ 推送通知
- ❌ App Store 发布

## 解决方案

### 方案 1: 继续使用免费账户（当前方案）

**适用场景**：
- 开发和测试阶段
- 个人使用
- 学习和原型开发

**操作**：
1. ✅ 已移除 iCloud 和 Apple Pay 权限
2. ✅ 云同步功能已禁用（代码中已处理）
3. ✅ IAP 使用 StoreKit Configuration 测试

**可以做的**：
- 开发所有本地功能
- 测试 IAP 购买流程（使用 StoreKit 测试）
- 在真机上运行和调试
- 导出数据到本地

**限制**：
- 无法使用云同步
- 无法发布到 App Store
- 真机签名每 7 天过期

### 方案 2: 升级到付费开发者账户（$99/年）

**适用场景**：
- 准备发布到 App Store
- 需要云同步功能
- 需要真实的 IAP 测试
- 商业应用

**优势**：
- ✅ 支持所有 Apple 服务
- ✅ 可以发布到 App Store
- ✅ 永久真机签名
- ✅ 完整的 CloudKit 功能
- ✅ 真实的 IAP 购买测试
- ✅ 推送通知

**如何升级**：
1. 访问 https://developer.apple.com/programs/
2. 点击 "Enroll"
3. 使用你的 Apple ID 登录
4. 支付 $99/年
5. 等待审核（通常 1-2 天）

## 当前配置

### Entitlements 文件

已将 iCloud 和 Apple Pay 权限注释掉：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <!-- 个人免费账户暂时不支持 iCloud 和 Apple Pay -->
    <!-- 如果升级到付费开发者账户，可以取消下面的注释 -->
    
    <!--
    <key>com.apple.developer.icloud-container-identifiers</key>
    <array>
        <string>iCloud.$(CFBundleIdentifier)</string>
    </array>
    ...
    -->
</dict>
</plist>
```

### 云同步状态

在 `ExpenseTrackerApp.swift` 中，云同步已被禁用：

```swift
var body: some Scene {
    WindowGroup {
        // 临时禁用云同步以测试 IAP 功能
        ContentView(repository: repository)
    }
}
```

## IAP 测试方法

### 使用 StoreKit Configuration 文件

**优势**：
- ✅ 无需付费账户
- ✅ 无需真实购买
- ✅ 可以测试所有购买流程
- ✅ 可以测试订阅管理

**步骤**：

1. **配置 StoreKit 文件**
   - 项目中已有 `Products.storekit`
   - 包含两个产品：
     - 年订阅：¥12/年
     - 终身购买：¥38

2. **在 Xcode 中配置**
   - Product → Scheme → Edit Scheme
   - Run → Options
   - StoreKit Configuration: 选择 `Products.storekit`

3. **测试购买**
   - 运行应用
   - 进入购买页面
   - 点击购买按钮
   - 会弹出测试购买对话框
   - 点击"订阅"或"购买"
   - 无需真实支付

4. **测试订阅管理**
   - Debug → StoreKit → Manage Transactions
   - 可以查看、取消、续订测试购买

## 功能对比表

| 功能 | 免费账户 | 付费账户 |
|------|---------|---------|
| 本地功能 | ✅ 完全支持 | ✅ 完全支持 |
| 真机调试 | ✅ 支持（7天签名） | ✅ 支持（永久） |
| IAP 测试 | ✅ StoreKit 测试 | ✅ 真实测试 |
| 云同步 | ❌ 不支持 | ✅ 支持 |
| App Store 发布 | ❌ 不支持 | ✅ 支持 |
| 推送通知 | ⚠️ 仅开发环境 | ✅ 完全支持 |
| TestFlight | ✅ 内部测试 | ✅ 公开测试 |

## 开发建议

### 当前阶段（免费账户）

**重点**：
1. ✅ 完善本地功能
2. ✅ 优化 UI/UX
3. ✅ 测试 IAP 流程（StoreKit）
4. ✅ 修复 Bug
5. ✅ 准备发布材料

**可以做的测试**：
- 所有本地功能
- IAP 购买流程
- 订阅管理
- 数据导出
- 统计分析

### 准备发布阶段

**需要付费账户时**：
1. 升级到付费开发者账户
2. 启用 iCloud 和 CloudKit
3. 配置真实的 IAP 产品
4. 提交 App Store 审核

## 下一步

### 现在可以做的：

1. ✅ 继续开发和测试本地功能
2. ✅ 使用 StoreKit Configuration 测试 IAP
3. ✅ 优化 UI 和用户体验
4. ✅ 修复发现的 Bug
5. ✅ 准备 App Store 截图和描述

### 升级账户后可以做的：

1. 启用云同步功能
2. 配置真实的 IAP 产品
3. 提交 App Store 审核
4. 发布应用

## 总结

**当前状态**：
- ✅ 所有本地功能正常工作
- ✅ IAP 可以使用 StoreKit 测试
- ❌ 云同步暂时无法使用（需要付费账户）

**建议**：
- 继续使用免费账户开发和测试
- 功能完善后再考虑升级到付费账户
- 升级后可以启用云同步和发布到 App Store

现在应用应该可以正常编译和运行了！
