# Google Drive 功能测试指南

## 测试前准备

### 1. Google Cloud 配置
在开始测试前，您需要：
1. 创建 Google Cloud 项目
2. 启用 Google Drive API
3. 创建 API 密钥和 OAuth 2.0 客户端 ID
4. 配置授权域名

**注意**：如果您没有 Google Cloud 账户或不想配置，可以跳过 Google Drive 功能测试，使用本地下载备份功能。

### 2. 测试环境
- 确保网络连接正常
- 使用支持现代 JavaScript 的浏览器
- 准备一个 Google 账户用于测试

## 测试步骤

### 第一阶段：配置测试

#### 1. 打开配置界面
1. 启动应用：`npm run dev`
2. 访问：http://localhost:5173
3. 进入设置页面
4. 选择"Google Drive"备份方式
5. 点击"配置"按钮

#### 2. 输入配置信息
1. 在弹出的配置窗口中输入：
   - API 密钥（从 Google Cloud Console 获取）
   - 客户端 ID（从 Google Cloud Console 获取）
2. 点击"测试连接"按钮

#### 3. 验证配置
- ✅ 成功：显示"Google Drive 连接测试成功"
- ❌ 失败：检查配置信息是否正确

### 第二阶段：认证测试

#### 1. Google 登录
1. 点击"测试连接"后会弹出 Google 登录窗口
2. 输入 Google 账户凭据
3. 授权应用访问 Google Drive

#### 2. 验证登录状态
- 配置界面应显示"已连接到 Google Drive"
- 显示登录的 Google 账户邮箱
- 备份方式选项显示"✓ 已连接"状态

### 第三阶段：备份功能测试

#### 1. 准备测试数据
1. 添加几条测试账单
2. 创建自定义账单类型
3. 添加归属人和支付方式

#### 2. 执行备份
1. 确保选择了"Google Drive"备份方式
2. 点击"立即备份"按钮
3. 等待备份完成

#### 3. 验证备份结果
- ✅ 成功：显示"备份成功！文件已上传到 Google Drive"
- ❌ 失败：检查网络连接和 Google Drive 存储空间

### 第四阶段：恢复功能测试

#### 1. 准备恢复测试
1. 记录当前数据状态
2. 删除一些测试数据（用于验证恢复效果）

#### 2. 执行恢复
1. 点击"恢复数据"按钮
2. 确认恢复操作
3. 等待页面重新加载

#### 3. 验证恢复结果
- ✅ 成功：数据完全恢复到备份时的状态
- ❌ 失败：检查备份文件是否存在

### 第五阶段：自动备份测试

#### 1. 配置自动备份
1. 设置备份间隔为"每天"（测试用）
2. 保存配置

#### 2. 模拟自动备份
由于自动备份间隔较长，可以：
1. 检查浏览器控制台日志
2. 确认自动备份定时器已启动
3. 手动触发自动备份检查（开发者工具）

## 测试检查清单

### 配置功能
- [ ] 能够打开 Google Drive 配置窗口
- [ ] 能够输入和保存 API 配置
- [ ] 配置验证功能正常工作
- [ ] 错误提示信息清晰

### 认证功能
- [ ] Google 登录窗口正常弹出
- [ ] 能够成功登录 Google 账户
- [ ] 登录状态正确显示
- [ ] 能够退出登录

### 备份功能
- [ ] 手动备份功能正常
- [ ] 备份成功提示正确
- [ ] 备份文件上传到 Google Drive
- [ ] 最后备份时间正确更新

### 恢复功能
- [ ] 能够从 Google Drive 恢复数据
- [ ] 数据恢复完整准确
- [ ] 恢复过程用户体验良好
- [ ] 错误处理机制完善

### 用户界面
- [ ] 配置界面美观易用
- [ ] 状态显示清晰准确
- [ ] 按钮响应及时
- [ ] 错误提示友好

## 常见测试问题

### 1. 配置问题
**现象**：测试连接失败
**可能原因**：
- API 密钥错误
- 客户端 ID 错误
- Google Cloud 项目配置不正确
- 网络连接问题

**解决方法**：
- 重新检查 Google Cloud Console 配置
- 确认 API 已启用
- 检查授权域名设置

### 2. 认证问题
**现象**：无法登录 Google 账户
**可能原因**：
- 浏览器阻止弹窗
- OAuth 配置错误
- 网络连接问题

**解决方法**：
- 允许浏览器弹窗
- 检查 OAuth 客户端配置
- 尝试不同浏览器

### 3. 备份问题
**现象**：备份失败
**可能原因**：
- Google Drive 存储空间不足
- 网络连接不稳定
- API 配额超限

**解决方法**：
- 检查 Google Drive 存储空间
- 确保网络连接稳定
- 检查 API 使用量

### 4. 恢复问题
**现象**：恢复失败
**可能原因**：
- Google Drive 中没有备份文件
- 备份文件格式错误
- 权限问题

**解决方法**：
- 确认备份文件存在
- 重新执行备份
- 重新登录 Google 账户

## 测试报告模板

```
Google Drive 功能测试报告

测试环境：
- 浏览器：
- 操作系统：
- 网络环境：
- Google 账户：

配置测试：
- API 密钥配置：✅/❌
- 客户端 ID 配置：✅/❌
- 连接测试：✅/❌

认证测试：
- Google 登录：✅/❌
- 权限授权：✅/❌
- 登录状态显示：✅/❌

备份测试：
- 手动备份：✅/❌
- 备份文件上传：✅/❌
- 状态更新：✅/❌

恢复测试：
- 数据恢复：✅/❌
- 数据完整性：✅/❌
- 用户体验：✅/❌

发现问题：
1. 
2. 
3. 

改进建议：
1. 
2. 
3. 

总体评价：
- 功能完整性：
- 用户体验：
- 稳定性：
- 推荐使用：是/否
```

## 注意事项

1. **网络环境**：在中国大陆测试时可能需要科学上网
2. **API 配额**：避免频繁测试导致 API 配额超限
3. **数据安全**：测试时使用测试数据，避免重要数据丢失
4. **浏览器兼容性**：在多种浏览器中测试以确保兼容性
5. **错误处理**：重点测试各种异常情况的处理