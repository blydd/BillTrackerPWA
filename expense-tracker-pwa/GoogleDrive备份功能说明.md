# Google Drive 备份功能说明

## 功能概述

Google Drive 备份功能允许用户将账单数据自动备份到 Google Drive 云端存储，实现跨设备数据同步和云端安全存储。

## 主要特性

### 1. 云端备份
- 自动上传备份文件到 Google Drive
- 使用应用专用文件夹（appDataFolder），用户不可见
- 支持自动备份和手动备份
- 备份文件加密存储在用户的 Google Drive 中

### 2. 数据同步
- 支持从 Google Drive 恢复数据
- 自动获取最新的备份文件
- 支持多设备间数据同步

### 3. 安全性
- 使用 OAuth 2.0 安全认证
- 数据存储在用户自己的 Google Drive 中
- 应用只能访问自己创建的备份文件
- 支持随时撤销授权

## 配置步骤

### 1. 创建 Google Cloud 项目

1. 访问 [Google Cloud Console](https://console.cloud.google.com/)
2. 创建新项目或选择现有项目
3. 记录项目 ID

### 2. 启用 Google Drive API

1. 在 Google Cloud Console 中，转到"API 和服务" > "库"
2. 搜索"Google Drive API"
3. 点击启用

### 3. 创建凭据

#### 创建 API 密钥
1. 转到"API 和服务" > "凭据"
2. 点击"创建凭据" > "API 密钥"
3. 复制生成的 API 密钥
4. 建议限制 API 密钥的使用范围

#### 创建 OAuth 2.0 客户端 ID
1. 在"凭据"页面，点击"创建凭据" > "OAuth 客户端 ID"
2. 选择应用类型："Web 应用"
3. 添加授权的 JavaScript 来源：
   - `http://localhost:5173`（开发环境）
   - `https://bill-tracker-pwa.vercel.app`（生产环境）
4. 复制生成的客户端 ID

### 4. 在应用中配置

1. 打开账单管理应用
2. 进入设置页面
3. 选择"Google Drive"备份方式
4. 点击"配置"按钮
5. 输入 API 密钥和客户端 ID
6. 点击"测试连接"验证配置
7. 保存配置

## 使用方法

### 首次设置
1. 完成上述配置步骤
2. 选择 Google Drive 备份方式
3. 点击"立即备份"
4. 系统会提示登录 Google 账户
5. 授权应用访问 Google Drive
6. 备份完成

### 日常使用
- **自动备份**：根据设置的间隔自动备份
- **手动备份**：随时点击"立即备份"
- **数据恢复**：点击"恢复数据"从云端恢复

### 多设备同步
1. 在新设备上打开应用
2. 配置相同的 Google Drive 设置
3. 登录同一个 Google 账户
4. 点击"恢复数据"同步数据

## 技术实现

### 核心技术
- **Google APIs Client Library**：用于与 Google Drive API 交互
- **OAuth 2.0**：安全的用户认证
- **Google Drive API v3**：文件上传、下载、管理

### 文件存储
- **存储位置**：Google Drive 应用数据文件夹
- **文件格式**：JSON 格式的备份文件
- **文件命名**：`账单备份_YYYYMMDD_HHMMSS.json`
- **访问权限**：仅应用可访问，用户不可见

### 数据安全
- 所有数据传输使用 HTTPS 加密
- 使用 Google 官方 API，安全可靠
- 支持随时撤销应用授权
- 备份文件存储在用户自己的 Google Drive 中

## 故障排除

### 常见问题

#### 1. 配置失败
**问题**：API 密钥或客户端 ID 无效
**解决方案**：
- 检查 API 密钥是否正确复制
- 确认客户端 ID 格式正确
- 验证 Google Cloud 项目中 API 已启用

#### 2. 登录失败
**问题**：无法登录 Google 账户
**解决方案**：
- 检查浏览器是否阻止弹窗
- 确认网络连接正常
- 尝试清除浏览器缓存
- 检查 OAuth 客户端配置

#### 3. 备份失败
**问题**：上传备份文件失败
**解决方案**：
- 检查 Google Drive 存储空间是否充足
- 确认网络连接稳定
- 重新登录 Google 账户
- 检查 API 配额是否超限

#### 4. 恢复失败
**问题**：无法从 Google Drive 恢复数据
**解决方案**：
- 确认 Google Drive 中存在备份文件
- 检查备份文件格式是否正确
- 重新登录 Google 账户
- 尝试手动下载备份文件

### 调试信息
- 打开浏览器开发者工具查看控制台日志
- 检查网络请求是否成功
- 验证 Google API 响应

## 限制和注意事项

### API 配额限制
- Google Drive API 有每日请求限制
- 频繁备份可能触发限制
- 建议合理设置备份间隔

### 浏览器兼容性
- 需要支持现代 JavaScript 的浏览器
- 某些旧版浏览器可能不支持
- 移动端浏览器完全支持

### 网络要求
- 需要稳定的网络连接
- 在中国大陆可能需要科学上网
- 建议在 WiFi 环境下进行大量数据同步

### 隐私考虑
- 备份数据存储在用户的 Google Drive 中
- Google 可能根据其隐私政策处理数据
- 建议阅读 Google 隐私政策

## 最佳实践

### 安全建议
1. 定期检查 Google 账户的应用授权
2. 不要在公共设备上保存登录状态
3. 定期更换 API 密钥（如果泄露）
4. 使用强密码保护 Google 账户

### 使用建议
1. 设置合理的自动备份间隔（建议每周）
2. 在重要操作前手动备份
3. 定期测试数据恢复功能
4. 保留本地备份作为双重保险

### 性能优化
1. 避免频繁备份大量数据
2. 在网络良好时进行备份操作
3. 监控 API 使用量避免超限
4. 合理使用批量操作

## 未来计划

### 功能增强
- 增量备份支持
- 备份文件加密
- 多版本备份管理
- 备份文件压缩

### 其他云服务
- 百度网盘集成（国内用户）
- 阿里云盘支持
- OneDrive 备份
- Dropbox 集成

### 高级功能
- 自动冲突解决
- 备份文件去重
- 跨平台数据迁移
- 备份统计和分析