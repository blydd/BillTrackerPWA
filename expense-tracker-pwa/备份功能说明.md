# 通用备份功能说明

## 功能概述

新的通用备份系统替代了之前的 File System Access API 备份，提供更好的浏览器兼容性。

## 支持的备份方式

### 1. 本地下载备份（推荐）
- **兼容性**：支持所有现代浏览器，包括移动端
- **工作原理**：生成 JSON 备份文件并自动下载到用户的下载文件夹
- **优点**：
  - 100% 浏览器兼容
  - 用户完全控制备份文件
  - 无需网络连接
  - 支持手动和自动备份

### 2. Google Drive 备份（开发中）
- **状态**：预留接口，暂未实现
- **计划功能**：自动上传备份到用户的 Google Drive
- **适用场景**：国际用户，需要云端同步

### 3. 禁用备份
- 完全关闭自动备份功能

## 自动备份间隔选项

- **每天**：每24小时自动备份一次
- **每3天**：每72小时自动备份一次  
- **每周**：每7天自动备份一次
- **禁用自动备份**：只允许手动备份

## 备份文件格式

```json
{
  "version": "1.0",
  "timestamp": "2026-01-17T10:30:00.000Z",
  "appName": "账单管理 PWA",
  "data": {
    "bills": [...],
    "categories": [...],
    "owners": [...],
    "paymentMethods": [...]
  }
}
```

## 使用方法

### 设置备份
1. 打开应用设置页面
2. 在"数据备份"区域选择备份方式
3. 设置自动备份间隔
4. 点击"立即备份"测试功能

### 恢复数据
1. 点击"恢复数据"按钮
2. 选择之前下载的备份文件（.json格式）
3. 确认恢复操作
4. 应用将自动重新加载

## 技术实现

### 核心服务
- `universalBackupService.ts`：通用备份服务
- 使用 IndexedDB 存储备份配置
- 支持多种备份方式的统一接口

### 浏览器兼容性
- **本地下载**：支持所有支持 Blob API 的浏览器
- **文件选择**：使用标准 HTML5 file input
- **移动端**：完全支持 iOS Safari 和 Android Chrome

### 数据安全
- 所有备份数据保存在用户本地
- 不上传到任何第三方服务器
- 用户完全控制备份文件的存储和使用

## 与旧版本的区别

### 旧版本（File System Access API）
- 只支持 Chrome/Edge 桌面版
- iOS Safari 完全不支持
- 需要用户授权文件夹访问权限

### 新版本（通用备份）
- 支持所有现代浏览器
- 移动端完全兼容
- 更简单的用户体验
- 更可靠的备份机制

## 后续计划

1. **Google Drive 集成**：实现云端备份功能
2. **国内云盘支持**：考虑支持百度网盘、阿里云盘等
3. **备份加密**：为敏感数据提供加密选项
4. **增量备份**：只备份变更的数据以减少文件大小